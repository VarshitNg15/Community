{% extends 'base.html' %}
{% block content %}
<h2>Admin Dashboard</h2>
<h3>Pending Issues</h3>
{% for issue in issues if issue.status != 'completed' %}
    <div class="issue">
        <p><b>Description:</b> {{ issue.description }}</p>
        <p><b>Category:</b> {{ issue.category }}</p>
        <p><b>Location:</b> {{ issue.address if issue.address else 'Location not available' }}</p>
        <img src="/uploads/{{ issue.photo_filename }}" alt="Issue Photo" width="120"><br>
        <span>Votes: {{ votes_map[issue._id|string] }}</span><br>
        <h4>Suggestions:</h4>
        <ul>
        {% for s in suggestions_map[issue._id|string] %}
            <li>{{ s.suggestion }}</li>
        {% endfor %}
        </ul>
        <!-- Show reports if any -->
        {% if reports_map[issue._id|string] %}
        <div class="reports">
            <h4>Reports:</h4>
            <ul>
            {% for report in reports_map[issue._id|string] %}
                <li><b>Reason:</b> {{ report.reason }} | <b>By User:</b> {{ report.reporter_id }}</li>
            {% endfor %}
            </ul>
        </div>
        {% endif %}
        <form method="POST" style="display:inline-block; margin-right:10px;">
            <input type="hidden" name="issue_id" value="{{ issue._id }}">
            <label for="plan">Plan of Execution:</label><br>
            <textarea id="plan" name="plan" required>{{ issue.plan_of_execution }}</textarea><br>
            <button type="submit" name="plan">Submit Plan</button>
        </form>
        <form method="POST" style="display:inline-block;">
            <input type="hidden" name="issue_id" value="{{ issue._id }}">
            <button type="submit" name="complete">Mark as Completed</button>
        </form>
        <a href="/admin/location/{{ issue._id }}" target="_blank"><button type="button">View Location</button></a>
        <div class="map-placeholder">
            <!-- Map integration placeholder: Use Leaflet.js or Google Maps here -->
            <div style="width: 300px; height: 200px; background: #eee; text-align: center; line-height: 200px;">Map Here</div>
        </div>
    </div>
    <hr>
{% endfor %}
<h3>Completed Issues</h3>
{% for issue in issues if issue.status == 'completed' %}
    <div class="issue completed">
        <p><b>Description:</b> {{ issue.description }}</p>
        <p><b>Category:</b> {{ issue.category }}</p>
        <p><b>Location:</b> {{ issue.address if issue.address else 'Location not available' }}</p>
        <img src="/uploads/{{ issue.photo_filename }}" alt="Issue Photo" width="120"><br>
        <span>Votes: {{ votes_map[issue._id|string] }}</span><br>
        <h4>Suggestions:</h4>
        <ul>
        {% for s in suggestions_map[issue._id|string] %}
            <li>{{ s.suggestion }}</li>
        {% endfor %}
        </ul>
        <!-- Show reports if any -->
        {% if reports_map[issue._id|string] %}
        <div class="reports">
            <h4>Reports:</h4>
            <ul>
            {% for report in reports_map[issue._id|string] %}
                <li><b>Reason:</b> {{ report.reason }} | <b>By User:</b> {{ report.reporter_id }}</li>
            {% endfor %}
            </ul>
        </div>
        {% endif %}
        <a href="/admin/location/{{ issue._id }}" target="_blank"><button type="button">View Location</button></a>
        <div class="map-placeholder">
            <!-- Map integration placeholder: Use Leaflet.js or Google Maps here -->
            <div style="width: 300px; height: 200px; background: #eee; text-align: center; line-height: 200px;">Map Here</div>
        </div>
    </div>
    <hr>
{% endfor %}
{% endblock %} 